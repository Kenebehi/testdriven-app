---

  name: 'Sync S3 DAGs and settings'
  
  on:
    release:
      types:
        - published
  
  jobs:
    sync-dags:
      name: Copy DAGs to S3
      runs-on: ubuntu-latest
      steps:
        - name: Checkout repo
          uses: actions/checkout@v3
          with:
            fetch-depth: 0
        
        - name: Print event Store value
          id: store_value
          run: |
            MY_VALUE="$(git rev-list -n 1 $(git tag --sort=-creatordate | sed -n '2p'))"
            echo "::set-output name=myOutput::$MY_VALUE"         

        - name: Get changed Airflow  DAG's
          id: updated-dags-files
          uses: tj-actions/changed-files@v35
          with:
            base_sha: "${{ steps.store_value.outputs.myOutput }}"
            files: |
              airflow/dags/**
          
        - name: print changed files
          run: |
            echo "${{ steps.updated-dags-files.outputs.all_changed_and_modified_files }}"


